## Содержание

1. [Базовая конфигурация](#Базовая_конфигурация)
2. [Хранение глобального состояния](#Хранение_глобального_состояния)
   1. [Проекты](#Проекты)
   2. [Домены](#Домены)
   3. [Порты](#Порты)
3. [Файл конфигурации проекта](#Файл_конфигурации_проекта)

## Базовая конфигурация

При использовании консольной утилиты некоторые ее модули могут обращаться к стандартной конфигурации, чтобы, например, получить базовый домен, путь до папки с сертификатами и тд.

Пример файла:

```json
{
	"domain": {
		// Базовая конфигурация модуля доменных имен
		"domain": "ktep-inside.local", // Базовое доменное имя
		"certDir": "/etc/nginx/certs/", // Путь до папки, куда будут сохраняться сертификаты
		"nginxConfigDir": "/etc/nginx/activate-sites", // Путь до директории, куда будут сохранятся конфигурации для доменных имен
		"enabledNginxConfigDir": "/etc/nginx/enabled-sites" // Путь до директории, куда будут активироваться конфигурации
	},
	"ports": {
		// Базовая конфигурация модуля управления портами
		"web": {
			// Название сектора портов
			"min": 501, // Минимальный порт
			"max": 1500 // Максимальный порт(включительно)
		},
		"back": {
			"min": 1501,
			"max": 3000
		},
		"db": {
			"min": 3001,
			"max": 5000
		},
		"other": {
			"min": 5001,
			"max": 8000
		},
		"reserve": {
			"min": 8001,
			"max": 50000
		}
	}
}
```

Это файл, создаваемый программой по умолчанию по пути `/etc/kinsidectl/default.json`. Он может быть изменен как вручную, так и используя [другой модуль утилиты](/articles/kinsidectl/config).

## Хранение глобального состояния

Для корректной работы программа хранит текущее состояние сервера: какие порты были выделены, какие освобождены, используемые доменные имена и к кому они приписаны. Файлы с этой информацией хранятся в директории `/etc/kinsidectl/`.

> **Внимание!!! Данные фалы ни в коем случаи не должны редактироваться руками, они используются программой и изменяются автоматически в течении ее работы. Любое ручное изменение может привести к поломке системы или ее некорректной работе**

### Проекты

Для восстановления и глобального управления проектами есть файл `/etc/kinsidectl/projects.json`.

Подробнее о работе с проектами можно почитать [здесь](/articles/kinsidectl/project)

Пример файла:

```json
{
	"main": {
		// Название проекта
		"dir": "/home/<user-name>/some/path", // Путь до директории проекта
		"usePorts": true, // Используется ли выделение портов для проекта
		"useDomain": true // Используется ли доменное имя для проекта
	}
}
```

### Домены

Для отслеживания глобального состояния доменных имен и связи их с проектом есть файл `/etc/kinsidectl/domains.json`.

Подробнее о работе с доменными именами можно почитать [здесь](/articles/kinsidectl/domain)

Пример файла:

```json
{
	"_using": ["ktep-inside.local"], // Используемые на сервере доменные имена
	"_map": {
		"ktep-inside.local": "main" // Ассоциация от доменного имени к названию проекта
	},
	"main": {
		// Название проекта
		"enabled": true, // Включено ли доменное имя
		"fullDomain": "ktep-inside.local", // Полное доменное имя(отличается от обыного, если указан поддомен). Именно оно используется в конфигурации
		"domain": "ktep-isnide.local", // Родительское доменное имя
		"subdomain": null, // Поддомен
		"cert": "/etc/nginx/certs/ktep-inside.local.crt", // Путь до SSL сертификата
		"config": "/etc/nginx/active-sites/ktep-inside.local.conf" // Путь до конфигурации глобального nginx для этого домена
	}
}
```

### Порты

Для отслеживания глобального состояния выделенных портов и связи их с проектом есть файл `/etc/kinsidectl/ports.json`.

Подробнее о работе с портами можно почитать [здесь](/articles/kinsidectl/ports)

Пример файла:

```json
{
	"_using": {
		// Используемые порты по направлениям
		"web": {
			// Направление
			"next": 502, // Следующий порт, который будет выделен
			"free": [] // Список портов, которые были выделены, а потом освобождены. При выделение портов сначала берутся порты из этого списка
		},
		"back": {
			"next": 1502,
			"free": []
		},
		"db": {
			"next": 3002,
			"free": []
		},
		"other": {
			"next": 5001,
			"free": []
		},
		"reserve": {
			"next": 8001,
			"free": []
		}
	},
	"main": {
		// Название проекта
		"db": [3001], // Список портов, выделенных под определенное направление, в порядке выделения
		"web": [501],
		"backend": [1501]
	}
}
```

## Файл конфигурации проекта

При создании проекта нового проекта, в его директории создается файл. Имя файла фиксировано - `.kinsiderc`.

Подробнее про управление проектом можно почитать [здесь](/articles/kinsidectl/project)

Максимальная конфигурация:

```json
{
	"name": "kinside", // Название проекта
	"envFile": ".env", // Путь до файла переменных, куда будет внедрены части конфига
	"network": {
		// Конфигурация, связанная с сетью
		"domain": {
			// Конфигурация доменного имени
			"enabled": true, // Активировано ли доменное имя
			"inject": true, // Внедрять переменны доменного имени в переменные среды
			"fullDomain": "ktep-inside.local", // Полное доменное имя
			"cert": "/etc/nginx/certs/ktep-inside.local.crt" // Путь до сертификата
		},
		"ports": {
			// Конфигурация портов
			"inject": true, // Внедрять порты в переменные среды
			"db": [3001], // Список портов по направлениям
			"web": [501],
			"backend": [1501]
		}
	}
}
```
